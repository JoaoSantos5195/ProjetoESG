    @model LearnFlow.ViewModels.MapaFaseViewModel;

    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="/css/mapa.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
        <title>LearnFlow</title>
    </head>
    <body>

    <!--SE NÃO TIVER MAPA, APARECE FORM -->
    @if (string.IsNullOrEmpty(Model.Mapa.TituloMapa) && string.IsNullOrEmpty(Model.Mapa.DescMapa))
    {
        <div>
            <form action="@Url.Action("CriarMapa", "Home")" method="post" enctype="multipart/form-data">
                <input type="file" name="Mapa.Imagem" accept=".jpg, .png" placeholder="Insira a capa do seu mapa" required><br>
                <input type="text" name="Mapa.TituloMapa" placeholder="Insira o Titulo do seu mapa" required><br>
                <textarea name="Mapa.DescMapa" placeholder="Insira uma descrição sobre o seu mapa de estudos" required></textarea><br>
                <input type="text" name="Mapa.LinkMapa" placeholder="Links gerais para estudo do mapa"><br>
                <button type="submit">Salvar</button>
            </form>
        </div>
    }
    else{
        <!-- CAPA DO MAPA -->
        <img src="@Model.Mapa.ImagemUrl" class="imgCapa" alt="Imagem Enviada" style="height:420px; width:1080px; border-radius: 60px; margin-top:30px;" />

        <!-- TITULO DO MAPA -->
        <h1 id="tituloMapa" class="text-center">
            @Model.Mapa.TituloMapa
            <i class="bi bi-pencil-square" style="font-size: 24px; cursor: pointer; margin-left: 8px;" onclick="abrirEditMapa()"></i>
        </h1>

        <!-- DIALOG EDITAR MAPA -->
        <dialog id="formEditMapa" class="formEditMapa">
            <form action="@Url.Action("editMapa", "Home")" method="post" enctype="multipart/form-data">
                <select name="opcao" id="opcao" class="form-control" onchange="mostrarCampo()">
                    <option value="">-- Selecione --</option>
                    <option value="tituloMapa">Titulo do mapa</option>
                    <option value="editFoto">Imagem da capa</option>
                    <option value="editDesc">Descrição do mapa</option>
                    <option value="editLink">Links de estudo</option>
                </select>

                <div id="campo-edicao" style="display: none;" class="mt-3">
                    <label id="label-edicao" for="novoValor">Qual o novo valor?</label>
                    <input type="text" name="novoValor" id="novoValor" class="form-control" />
                    <input type="file" name="novaImagem" id="novaImagem" style="display: none;" />
                </div>

                <button type="submit" class="btn btn-primary mt-3">Confirmar Edição</button>
            </form>
        </dialog>

        <div class="tudo">
            <div class="fases">
                @foreach (var fase in Model.TodasFases)
                {
                    if (fase.IdFase % 2 == 0)
                    {
                        <img src="~/assets/icons/circuloFase.png" alt="CirculoFase" id="faseImagem" style="height:80px; width:80px; margin-left: 200px" onclick="abrirDialogFase(@fase.IdFase)" />
                        <p style="margin-left: 200px">Fase @fase.IdFase</p>
                    }
                    else
                    {
                        <img src="~/assets/icons/circuloFase.png" id="faseImagem" alt="CirculoFase" style="height:80px; width:80px;" onclick="abrirDialogFase(@fase.IdFase)" />
                        <p>Fase @fase.IdFase</p>
                    }

                    <dialog id="faseDialog_@fase.IdFase" class="faseDialog">
                        @if (string.IsNullOrEmpty(fase.TituloFase) && string.IsNullOrEmpty(fase.DescFase) && string.IsNullOrEmpty(fase.LinkFase))
                        {
                            <form action="@Url.Action("CriarFase", "Home")" method="post">
                                <input type="hidden" name="Fase.IdFase" value="@fase.IdFase" />
                                <input type="text" name="Fase.TituloFase" placeholder="Qual o título da fase?" /><br>
                                <textarea name="Fase.DescFase" placeholder="Qual a descrição da fase?"></textarea><br>
                                <input type="text" name="Fase.LinkFase" placeholder="Links para estudo aprofundado" /><br>
                                <button type="submit">Salvar</button>
                                <button type="button" onclick="fecharDialogFase(@fase.IdFase)">Fechar</button>
                            </form>
                        }
                        else
                        {
                            <h4>@fase.TituloFase (Fase @fase.IdFase)</h4>
                            <p>@fase.DescFase</p>
                            <p>Links: <a href="@fase.LinkFase" target="_blank">@fase.LinkFase</a></p>
                            <button id="concluirFase" onclick="concluir()">Marcar como concluido</button>
                            <button type="button" onclick="fecharDialogFase(@fase.IdFase)">Fechar</button>
                            <button type="button" onclick="abrirDialogFase(@fase.IdFase)">Editar fase</button>
                            <!-- BOTÃO PARA DELETAR FASE -->
                            <form action="@Url.Action("DeletarFase", "Home")" method="post" style="display: inline;">
                                <input type="hidden" name="idFase" value="@fase.IdFase" />
                                <button type="submit" class="btn-delete" onclick="return confirm('Tem certeza que deseja deletar esta fase?')">Deletar Fase</button>
                            </form>
                        }
                    </dialog>
                }

                <button onclick="abrirDialogNovaFase()">Adicionar Nova Fase</button>

                <dialog id="novaFaseDialog" class="formEditFase">
                    <form action="@Url.Action("CriarFase", "Home")" method="post">
                        <input type="hidden" name="Fase.IdFase" value="0" />
                        <input type="text" name="Fase.TituloFase" placeholder="Qual o título da fase?" /><br>
                        <textarea name="Fase.DescFase" placeholder="Qual a descrição da fase?"></textarea><br>
                        <input type="text" name="Fase.LinkFase" placeholder="Links para estudo aprofundado" /><br>
                        <button type="submit">Salvar</button>
                        <button type="button" onclick="fecharDialogNovaFase()">Fechar</button>
                    </form>
                </dialog>
            </div>
    

            <div class="descricaoFase">
                <h3>Sobre o roadmap</h3>
                <p class="text-justify">@Model.Mapa.DescMapa</p>
                <br>
                <ul>
                    <li><a href="@Model.Mapa.LinkMapa">@Model.Mapa.LinkMapa</a></li>
                </ul>
            </div>
        </div>

        <hr>
        <!-- Substitua o botão atual por este: -->
        <form id="formExcluirMapa" asp-action="ExcluirMapa" method="post">
            <button type="button" onclick="confirmarExclusao()" class="btn-excluir">
                <i class="bi bi-trash-fill"></i> Excluir Mapa Permanentemente
            </button>
        </form>

        <script>
            function confirmarExclusao() {
                Swal.fire({
                    title: 'Confirmação',
                    text: "Tem certeza que deseja excluir este mapa completamente?",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Sim, excluir!',
                    cancelButtonText: 'Cancelar'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Adiciona spinner de carregamento
                        Swal.showLoading();
                        
                        // Submete o formulário
                        document.getElementById('formExcluirMapa').submit();
                    }
                });
            }
        </script>
        <hr>

        <h2 id="comentarioTitulo" class="text-center">Comentários</h2>
    }

        <script>
            const formEditMapa = document.getElementById("formEditMapa");
            const formEditFase = document.getElementById("formEditFase");
            const faseIdInput = document.getElementById("faseIdInput");
            const faseImagem = document.getElementById("faseImagem");
            const faseDialog = document.getElementById("faseDialog");

            //ABRIR POP UP EDIÇÃO DE MAPA
            function abrirEditMapa() {
                formEditMapa.showModal();
            }
            function fecharEditMapa() {
                formEditMapa.close();
            }
            //ABRIR POP UP DAS FASES
            function abrirDialogFase(idFase) {
                const dialog = document.getElementById('faseDialog_' + idFase);
                if (dialog) dialog.showModal();
            }
            function fecharDialogFase(idFase) {
                const dialog = document.getElementById('faseDialog_' + idFase);
                if (dialog) dialog.close();
            }

            function abrirDialogNovaFase() {
                document.getElementById("novaFaseDialog").showModal();
            }
            function fecharDialogNovaFase() {
                document.getElementById("novaFaseDialog").close();
            }
            //FUNÇÃO PARA MUDAR INPUT DO CAMPO DE EDIÇÃO DO MAPA
            function mostrarCampo() {
                const opcao = document.getElementById("opcao").value;
                const campoEdicao = document.getElementById("campo-edicao");
                const inputTexto = document.getElementById("novoValor");
                const inputImagem = document.getElementById("novaImagem");

                campoEdicao.style.display = "block";
                inputTexto.style.display = "none";
                inputImagem.style.display = "none";

                if (opcao === "editFoto") {
                    inputImagem.style.display = "block";
                } else {
                    inputTexto.style.display = "block";
                }
            }
            //FUNÇÃO PARA EFEITO DE CONCLUSÃO DE FASE
            function concluir() {
                if (faseImagem.src.includes("circuloFase.png")) {
                    faseImagem.src = "/assets/icons/circuloConcluido.png ";
                    faseImagem.style.borderRadius = "50%";         // Deixa a imagem arredondada (círculo perfeito)
                    faseImagem.style.boxShadow = "0 0 10px #4CAF50"; // Sombra verde suave
                    faseImagem.style.transition = "all 0.3s ease";  // Transição suave
                    faseImagem.style.width = "80px";
                    faseImagem.style.height="80px";
                }
            formEditFase.close();            
            faseDialog.clone();
            fecharDialogFase();
            }
        </script>

    </body>
    </html>
